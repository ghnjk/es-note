# ES类型实现

类型 在 Elasticsearch 中表示一组相似的文档。类型 由一个 名称（比如 user 或 blogpost ）和一个类似数据库表结构的映射组成，描述了文档中可能包含的每个字段的 属 性，数据类型（比如 string , integer 或 date ），和是否这些字段需要被 Lucene 索引或 储存。

## Lucene 如何处理文档

Lucene 中，一个文档由一组简单的键值对组成，一个字段至少需要有一个值，但是任何字段 都可以有多个值。类似的，一个单独的字符串可能在分析过程中被转换成多个值**。Lucene 不 关心这些值是字符串，数字或日期，所有的值都被当成 不透明字节**

当我们在 Lucene 中索引一个文档时，每个字段的值都被加到相关字段的倒排索引中。你也可 以选择将原始数据 储存 起来以备今后取回。‘’

## 类型是怎么实现的

Elasticsearch 类型是在这个简单基础上实现的。一个索引可能包含多个类型，每个类型有各 自的映射和文档，保存在同一个索引中。

因为 Lucene 没有文档类型的概念，每个文档的类型名被储存在一个叫 \_type 的元数据字段 上。当我们搜索一种特殊类型的文档时，Elasticsearch 简单的通过 \_type 字段来过滤出这些 文档。

Lucene 同样没有映射的概念。映射是 Elasticsearch 将复杂 JSON 文档映射成 Lucene 需要 的扁平化数据的方式。

例如， user 类型中 name 字段的映射声明这个字段是一个 string 类型，在被加入倒排索 引之前，它的数据需要通过 whitespace 分析器来分析。

```text
"name": {
    "type": "string",
    "analyzer": "whitespace"
}
```

## 预防类型陷阱

事实上不同类型的文档可以被加到同一个索引里带来了一些预想不到的困难。 Elasticsearch权威指南（中文版）想象一下我们的索引中有两种类型： blog\_en 表示英语版的博客， blog\_es 表示西班牙语版 的博客。两种类型都有 title 字段，但是其中一种类型使用 english 分析器，另一种使用 spanish 分析器。



